<!DOCTYPE html>
<html lang="en">



<!-- Banner at the top -->
<header id="top-banner">
    <!-- Left logo and name -->
    <div id="left-banner">
        <img src="/static/revolving_door.svg" alt="Left Logo" id="banner-logo-left">
        <h1 id="banner-title-left">Revolving Door Watch</h1>
    </div>

    <!-- Right logo and name -->
    <div id="right-banner">
        <h1 id="banner-title-right">Follow The Money</h1>
        <img src="/static/ftm-logo.jpg" alt="Right Logo" id="banner-logo-right">
    </div>
</header>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revolving Door Watch</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .tab-container {
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            border: none;
            background-color: #f4f4f4;
            cursor: pointer;
            font-size: 16px;
        }
        .tab-button.active {
            background-color: #ddd;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }

        th {
            background-color: #f4f4f4;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
        }
        .name-with-photo {
            display: flex;
            align-items: center;
        }
        .checkmark {
            font-size: 18px;
            cursor: pointer;
        }
        .checkmark.green {
            color: green;
        }
        .checkmark.red {
            color: red;
        }
        .twitter-logo {
            width: 24px;
            height: 24px;
        }
        #searchField {
            margin-bottom: 20px;
            padding: 10px;
            width: 100%;
            max-width: 400px;
        }
        .bio-old {
            color: red;
        }
        .bio-new {
            color: green;
        }

        /* Person entry styling */
        #people-news-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #people-news-table th, #people-news-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #people-news-table th {
            background-color: #f4f4f4;
        }

        #people-news-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Styling for news list within each person */
        .news-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .news-list li {
            margin-bottom: 10px;
        }

        .news-summary {
            background-color: #f9f9f9;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
        }

        .toggle-summary-button {
            margin-left: 10px;
            cursor: pointer;
            padding: 5px;
            background-color: #ddd;
            border: none;
            font-size: 12px;
        }

        .toggle-summary-button:hover {
            background-color: #ccc;
        }

        #filter-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        #filter-container label {
            margin-right: 10px;
            font-weight: bold;
        }

        #filter-date {
            padding: 5px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        /* Styling for the Expand button */
        .toggle-summary-button {
            margin-right: 10px;
            cursor: pointer;
            padding: 5px;
            background-color: #ddd;
            border: none;
            font-size: 12px;
            font-weight: bold;
        }

        .toggle-summary-button:hover {
            background-color: #ccc;
        }

        .news-summary {
            background-color: #f9f9f9;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
        }

        /* Styling for the down arrow SVG */
        .toggle-summary-arrow {
            width: 16px;
            height: 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-right: 10px;
        }

        /* Style for the news-summary div (remains unchanged) */
        .news-summary {
            background-color: #f9f9f9;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
        }
        /* Log type colors */
        .log-type.debug {
            color: blue;
        }

        .log-type.info {
            color: green;
        }

        .log-type.error {
            color: red;
        }

        .log-type.critical {
            color: darkred;
        }

        /* Table styling */
        #logs-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #logs-table th, #logs-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #logs-table th {
            background-color: #f4f4f4;
        }

        #logs-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #refresh-button {
            background-color: #4CAF50; /* Green */
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 4px;
        }

        #refresh-button:hover {
            background-color: #45a049;
        }
        /* Top banner styling */
        #top-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #f5f2ed;  /* Background color */
            height: 70px;
            display: flex;
            justify-content: space-between;  /* Space between left and right sections */
            align-items: center;
            padding: 0 20px;
            z-index: 1000;  /* Ensure the banner stays on top of other content */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);  /* Add a subtle shadow */
        }

        /* Left banner styling */
        #left-banner {
            display: flex;
            align-items: center;
            flex-shrink: 0; /* Prevent the left section from shrinking */
        }

        #banner-logo-left {
            height:     60px;
            margin-right: 20px;
            object-fit: contain;  /* Keep the aspect ratio */
        }

        #banner-title-left {
            color: rgb(221, 50, 48);
            font-size: 24px;
            font-weight: bold;
        }

        /* Right banner styling */
        #right-banner {
            display: flex;
            align-items: center;
            padding-right: 30px;  /* Add space between the right logo and the scrollbar */
        }

        #banner-title-right {
            color: rgb(221, 50, 48);
            font-size: 24px;
            font-weight: bold;
            margin-right: 20px;  /* Space between name and logo */
        }

        #banner-logo-right {
            height: 50px;
        }

        /* Ensure that the content below the banner starts after the banner */
        body {
            margin-top: 90px;  /* Adjust margin to accommodate the fixed banner height */
        }

    /* Add some padding to the form and center it */
        .styled-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Style each form group */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-group input[type="text"],
        .form-group input[type="url"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="url"]:focus {
            outline: none;
            border-color: #007BFF;
            box-shadow: 0 0 3px rgba(0, 123, 255, 0.5);
        }

        /* Style for the submit button */
        .styled-button {
            width: 100%;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            text-transform: uppercase;
        }

        .styled-button:hover {
            background-color: #218838;
        }

        /* Responsive form */
        @media (max-width: 600px) {
            .styled-form {
                width: 100%;
            }
        }


        th, td {
            padding: 10px;
            text-align: left;
        }


        td img.profile-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            margin-right: 10px;
        }

        td img.delete-icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .name-with-photo {
            display: flex;
            align-items: center;
        }

        a {
            text-decoration: none;
            color: #007BFF;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        function toggleActiv(id) {
            // Send AJAX request to toggle the activ field
            fetch(`/toggle_activ/${id}`, {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // Update the checkmark color and symbol based on new value
                      const checkmark = document.getElementById(`checkmark-${id}`);
                      if (data.activ) {
                          checkmark.classList.remove('red');
                          checkmark.classList.add('green');
                          checkmark.innerHTML = '&#10003;'; // Green checkmark for True
                      } else {
                          checkmark.classList.remove('green');
                          checkmark.classList.add('red');
                          checkmark.innerHTML = '&#10007;'; // Red cross for False
                      }
                  }
              });
        }

        function searchNames() {
            const input = document.getElementById('searchField').value.toLowerCase();
            const table = document.querySelector('.tab-content.active table');
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName('td')[0]; // Name column
                if (td) {
                    const name = td.textContent || td.innerText;
                    if (name.toLowerCase().indexOf(input) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function switchTab(tabId) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // Reset active tab button styling
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // Load subjects and apply filter for each tab
            if (tabId === 'tab1') {
                loadTwitterSubjects().then(() => filterBySubject('twitterTable'));  // Load subjects and filter table
            } else if (tabId === 'tab2') {
                loadBiosAggSubjects().then(() => filterBySubject('biosAggTable'));  // Load subjects and filter table
            } else if (tabId === 'tab3') {
                loadPeopleNews();  
                loadRssSubjects().then(() => filterBySubject('people-news-table'));  // Load subjects and filter table
            }
        }

        function loadPeopleNews() {
            // Get filter values
            const startDate = document.getElementById('filter-date') ? document.getElementById('filter-date').value : null;
            const country = document.getElementById('countryFilterTab3').value;
            const party = document.getElementById('partyFilterTab3').value;
            const group = document.getElementById('groupFilterTab3').value;
            const subject = document.getElementById('subjectFilterTab3').value;
            const isNews = document.getElementById('isNewsFilterTab3').value;  // Get the value from the is_news filter

            // Construct query parameters
            const params = new URLSearchParams();
            if (startDate) params.append('start_date', startDate);
            if (country) params.append('country', country);
            if (party) params.append('party', party);
            if (group) params.append('groupe', group);
            if (subject) params.append('subject', subject);
            if (isNews === 'true') {
                params.append('is_news', 'true');
            } else if (isNews === 'false') {
                params.append('is_news', 'false');
            }
            // Fetch data with filters
            fetch('/get_people_news?' + params.toString())
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('people-news-container');
                    container.innerHTML = ''; // Clear any existing content

                    if (data.length === 0) {
                        container.innerHTML = '<tr><td colspan="4">No data found</td></tr>';
                        return;
                    }

                    data.forEach(person => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td>
                                <img src="${person.photo}" alt="Profile Photo" style="width: 50px; height: 50px; object-fit: cover;">
                            </td>
                            <td>
                                <a href="${person.profile_url}" target="_blank">${person.name}</a>
                            </td>
                            <td>
                                <ul class="news-list">
                                    ${person.news.map(news => `
                                        <li data-published="${news.published}">
                                            <img src="/static/down_arrow.svg" class="toggle-summary-arrow" onclick="toggleSummary(this)" alt="Expand Arrow" style="cursor: pointer; width: 16px; height: 16px;">
                                            <a href="${news.link}" target="_blank" style="color: ${news.in_transparency ? 'red' : 'inherit'};">${news.title}</a>
                                            <div class="news-summary" style="display: none;">
                                                <p>${news.summary}</p>
                                                <small>Published: ${new Date(news.published).toLocaleDateString()}</small>
                                            </div>
                                        </li>
                                    `).join('')}
                                </ul>
                            </td>
                            <td>${person.subject || 'N/A'}</td>
                        `;

                        container.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error fetching people news:', error);
                    document.getElementById('people-news-container').innerHTML = '<tr><td colspan="4">Error loading data</td></tr>';
                });
        }

        function toggleSummary(arrow) {
            const summaryDiv = arrow.nextElementSibling.nextElementSibling;
            if (summaryDiv.style.display === 'none') {
                summaryDiv.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';  // Rotate the arrow 180 degrees when expanded
            } else {
                summaryDiv.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';  // Reset the arrow when collapsed
            }
        }

        function loadLogs() {
            // Get the selected log types from checkboxes
            const selectedTypes = Array.from(document.querySelectorAll('.log-filter:checked')).map(checkbox => checkbox.value);

            // Build the query string based on the selected log types
            const queryString = selectedTypes.length ? `?types[]=${selectedTypes.join('&types[]=')}` : '';

            // Fetch the logs from the server based on the selected types
            fetch(`/get_logs${queryString}`)
                .then(response => response.json())
                .then(logs => {
                    const container = document.getElementById('logs-container');
                    container.innerHTML = ''; // Clear any existing content

                    if (logs.length === 0) {
                        container.innerHTML = '<tr><td colspan="3">No logs found</td></tr>';
                        return;
                    }

                    // Create rows for each log entry
                    logs.forEach(log => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td class="log-type ${log.type.toLowerCase()}">${log.type}</td>
                            <td>${log.msg}</td>
                            <td>${new Date(log.date).toLocaleString()}</td>
                        `;

                        container.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error fetching logs:', error);
                    document.getElementById('logs-container').innerHTML = '<tr><td colspan="3">Error loading data</td></tr>';
                });
        }

        // Event listener to load logs when checkboxes are changed
        document.querySelectorAll('.log-filter').forEach(checkbox => {
            checkbox.addEventListener('change', loadLogs);
        });


        function clearLogs() {
            // Confirm before clearing logs
            if (confirm('Are you sure you want to delete all logs? This action cannot be undone.')) {
                fetch('/clear_logs', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert(data.message);  // Show success message
                            loadLogs();  // Reload the logs after clearing
                        } else {
                            alert('Error clearing logs: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error clearing logs:', error);
                        alert('Error clearing logs.');
                    });
            }
        }
        function clearDiff() {
            // Confirm before clearing logs
            if (confirm('Are you sure you want to delete all differences detected? This action cannot be undone.')) {
                fetch('/clear_agg', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert(data.message);  // Show success message
                            loadLogs();  // Reload the logs after clearing
                        } else {
                            alert('Error clearing differences: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error clearing differences:', error);
                        alert('Error clearing differences.');
                    });
            }
        }

        function addUser() {
            const name = document.getElementById('name').value;
            const profileUrl = document.getElementById('profileUrl').value;
            const photoUrl = document.getElementById('photoUrl').value;
            const twitterUsername = document.getElementById('twitterUsername').value;
            const googleAlertFeed = document.getElementById('googleAlertFeed').value;
            const NewsgoogleAlertFeed = document.getElementById('NewsgoogleAlertFeed').value;
            const subject = document.getElementById('subject').value;



            // Check if twitterUsername is a URL or starts with x.com or twitter.com
            try {
                const url = new URL(twitterUsername);
                alert('Twitter Username should not be a URL.');
                return false;
            } catch (e) {
                // twitterUsername is not a URL, continue
            }

            if (twitterUsername.startsWith('x.com') || twitterUsername.startsWith('twitter.com')) {
                alert('Twitter Username should not be a URL.');
                return false;
            }

            if (!twitterUsername && !googleAlertFeed) {
                alert('Please provide either a Twitter Username and/or a Google Alert Feed URL.');
                return false;
            }
            if (!googleAlertFeed && !NewsgoogleAlertFeed) {
                alert('Please provide a Godd Feed URL for all items and news only items.');
                return false;
            }


            // Send the data to the server
            fetch('/add_user', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name, profileUrl, photoUrl, twitterUsername, googleAlertFeed, NewsgoogleAlertFeed, subject  
                })
            }).then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('User added successfully!');
                } else {
                    alert('Error adding user: ' + data.message);
                }
            }).catch(error => {
                alert('Error adding user: ' + error.message);
            });

            return false;  // Prevent form submission
        }
        function loadTwitterBios() {
            fetch('/get_twitter_bios_extra')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('twitterBiosTableBody');
                    tableBody.innerHTML = '';

                    if (data.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="3">No users found</td></tr>';
                        return;
                    }

                    data.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="name-with-photo">
                                    <img src="${user.photo}" alt="Profile Picture" class="profile-img" />
                                    <a href="${user.profile_url}" target="_blank">${user.name}</a>
                                </div>
                            </td>
                            <td>
                                <a href="https://x.com/${user.twitter_username}" target="_blank">
                                    <img src="https://cdn-icons-png.freepik.com/256/3670/3670211.png?semt=ais_hybrid" alt="Twitter" class="twitter-logo">
                                </a>
                            </td>          
                            <td>${user.subject || 'N/A'}</td>                   
                            <td><img src="/static/delete.svg" class="delete-icon" onclick="deleteUser('twitter', '${user.userID}')"></td>
                        `;
                        tableBody.appendChild(row);
                    });
                });
        }

        // Fetch and display RSS Feeds Collection (users with userID starting with 'EXTRA')
        function loadRssFeeds() {
            fetch('/get_rss_feeds_extra')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('rssFeedsTableBody');
                    tableBody.innerHTML = '';

                    if (data.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="2">No users found</td></tr>';
                        return;
                    }

                    data.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="name-with-photo">
                                    <img src="${user.photo}" alt="Profile Picture" class="profile-img" />
                                    <a href="${user.profile_url}" target="_blank">${user.name}</a>
                                </div>
                            </td>
                            <td>${user.subject || 'N/A'}</td> 
                            <td><img src="/static/delete.svg" class="delete-icon" onclick="deleteUser('rss', '${user.userID}')"></td>
                        `;
                        tableBody.appendChild(row);
                    });
                });
        }
        // Delete user from either twitter_bios or rss_feeds collection
        function deleteUser(collection, userID) {
            if (confirm('Are you sure you want to delete this user?')) {
                fetch(`/delete_user/${collection}/${userID}`, {
                    method: 'DELETE'
                }).then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('User deleted successfully!');
                        loadTwitterBios();
                        loadRssFeeds();
                    } else {
                        alert('Error deleting user: ' + data.message);
                    }
                });
            }
        }
        function loadTwitterSubjects() {
            return fetch('/get_unique_subjects_twitter')
                .then(response => response.json())
                .then(subjects => {
                    const subjectFilter = document.getElementById('subjectFilterTab1');
                    subjectFilter.innerHTML = '<option value="">All</option>';  // Reset dropdown

                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        subjectFilter.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching unique subjects for Twitter:', error);
                });
        }
        function loadBiosAggSubjects() {
            return fetch('/get_unique_subjects_bios_agg')
                .then(response => response.json())
                .then(subjects => {
                    const subjectFilter = document.getElementById('subjectFilterTab2');
                    subjectFilter.innerHTML = '<option value="">All</option>';  // Reset dropdown

                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        subjectFilter.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching unique subjects for Bio Difference:', error);
                });
        }
        function loadRssSubjects() {
            return fetch('/get_unique_subjects_rss')
                .then(response => response.json())
                .then(subjects => {
                    const subjectFilter = document.getElementById('subjectFilterTab3');
                    subjectFilter.innerHTML = '<option value="">All</option>';  // Reset dropdown

                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        subjectFilter.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching unique subjects for RSS Feeds:', error);
                });
        }

        // Call functions to load tables on page load
    loadTwitterBios();
    loadRssFeeds();
    function filterBySubject(tableId) {
        let subjectFilter;
        // Determine which filter to use based on the table ID
        if (tableId === 'twitterTable') {
            subjectFilter = document.getElementById('subjectFilterTab1');
        } else if (tableId === 'biosAggTable') {
            subjectFilter = document.getElementById('subjectFilterTab2');
        } else if (tableId === 'people-news-table') {
            subjectFilter = document.getElementById('subjectFilterTab3');
        }

        const selectedSubject = subjectFilter.value.toLowerCase();  // Get selected subject
        const rows = document.querySelectorAll(`#${tableId} tbody tr`);  // Get all rows in the table
        // Loop through each row and filter based on the subject
        rows.forEach(row => {
            const subjectCell = row.querySelector('td:nth-child(4)').textContent.toLowerCase();  // Get the subject text in the 3rd column
            if (selectedSubject === '' || subjectCell.includes(selectedSubject)) {
                row.style.display = '';  // Show the row if subject matches or 'All' is selected
            } else {
                row.style.display = 'none';  // Hide the row if subject doesn't match
            }
        });
    }

    function loadPeopleNewsFilters() {
        // Fetch filter values from the server
        fetch('/get_people_news_filters')
            .then(response => response.json())
            .then(filters => {
                // Get the dropdown elements for each filter
                const countryFilter = document.getElementById('countryFilterTab3');
                const partyFilter = document.getElementById('partyFilterTab3');
                const groupFilter = document.getElementById('groupFilterTab3');
                const subjectFilter = document.getElementById('subjectFilterTab3');

                // Helper function to populate a dropdown
                function populateDropdown(dropdown, options) {
                    dropdown.innerHTML = '<option value="">All</option>';  // Add "All" as the default option
                    options.forEach(option => {
                        const optElement = document.createElement('option');
                        optElement.value = option;
                        optElement.textContent = option;
                        dropdown.appendChild(optElement);
                    });
                }

                // Populate each filter dropdown with the fetched data
                populateDropdown(countryFilter, filters.constituencies_country);
                populateDropdown(partyFilter, filters.constituencies_party);
                populateDropdown(groupFilter, filters.groups_organization);
                populateDropdown(subjectFilter, filters.subject);
            })
            .catch(error => {
                console.error('Error loading people news filters:', error);
            });
    }

    // Call loadPeopleNewsFilters when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadPeopleNewsFilters();  // Load filter values on page load
        switchTab('tab1');  // Ensure the first tab is active by default
    });

    </script>
</head>
<body>

    <!-- Tab buttons -->
    <div class="tab-container">
        <button class="tab-button active" data-tab="tab1" onclick="switchTab('tab1')">Twitter Bio</button>
        <button class="tab-button" data-tab="tab2" onclick="switchTab('tab2')">Bio Difference</button>
        <button class="tab-button" data-tab="tab3" onclick="switchTab('tab3')">People News</button>
        <button class="tab-button" data-tab="tab4" onclick="switchTab('tab4')">Logs</button>
        <button class="tab-button" data-tab="tab5" onclick="switchTab('tab5')">Add User</button>
    </div>


    <!-- Tab 1: Twitter Bios -->
    <div id="tab1" class="tab-content active">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                switchTab('tab1');
            });
        </script>
        <!-- Search Field -->
        <div id="filter-container-1" style="margin-bottom: 20px;">
            <input type="text" id="searchField" onkeyup="searchNames()" placeholder="Search for names..." />
            <label for="subjectFilterTab1">Filter by Subject:</label>
            <select id="subjectFilterTab1" onchange="filterBySubject('twitterTable')">
                <option value="">All</option>
                <!-- Options will be dynamically populated based on unique subjects -->
            </select>
        </div>

        {% if entries %}
        <table id="twitterTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Bio</th>
                    <th>Last Checked</th>
                    <th>Subject</th>
                    <th>Active</th>
                    <th>Twitter</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr>
                    <td>
                        <div class="name-with-photo">
                            {% if entry.meta and 'url' in entry.meta %}
                                <img src="{{ entry.photo }}" alt="Profile Photo">
                            {% endif %}
                            <span>
                                {% if entry.meta and 'url' in entry.meta %}
                                    <a href="{{ entry.meta.url }}" target="_blank">{{ entry.name }}</a>
                                {% else %}
                                    {{ entry.name }}
                                {% endif %}
                            </span>
                        </div>
                    </td>
                    <td>{{ entry.bio }}</td>
                    <td>{{ entry.last_check }}</td>
                    <td>{{ entry.subject }}</td>
                    <td>
                        <span id="checkmark-{{ entry._id }}" class="checkmark {% if entry.activ %}green{% else %}red{% endif %}" 
                              onclick="toggleActiv('{{ entry._id }}')">
                            {% if entry.activ %}
                                &#10003;
                            {% else %}
                                &#10007;
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <a href="https://x.com/{{ entry.twitter_username }}" target="_blank">
                            <img src="https://cdn-icons-png.freepik.com/256/3670/3670211.png?semt=ais_hybrid" alt="Twitter" class="twitter-logo">
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No entries found in the database.</p>
        {% endif %}
    </div>

    <!-- Tab 2: Bios Agg -->
    <div id="tab2" class="tab-content">
        {% if bios_agg %}
        <!-- Checkboxes for filtering by log type -->
        <div id="filter-container-2" style="margin-bottom: 20px;">
            <button id="clear-button" onclick="clearDiff()" style="margin-left: 20px; padding: 5px 10px; background-color: red; color: white;">Clear Differences</button>

            <label for="subjectFilterTab2">Filter by Subject:</label>
            <select id="subjectFilterTab2" onchange="filterBySubject('biosAggTable')">
                <option value="">All</option>
                <!-- Options will be dynamically populated based on unique subjects -->
            </select>
        </div>
        
        <table id="biosAggTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Old Bio</th>
                    <th>New Bio</th>
                    <th>Subject</th>
                    <!--<th>Active</th>-->
                    <th>Twitter</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in bios_agg %}
                <tr>
                    <td>
                        <div class="name-with-photo">
                            {% if entry.meta and 'url' in entry.meta %}
                                <img src="{{ entry.photo }}" alt="Profile Photo">
                            {% endif %}
                            <span>
                                {% if entry.meta and 'url' in entry.meta %}
                                    <a href="{{ entry.meta.url }}" target="_blank">{{ entry.name }}</a>
                                {% else %}
                                    {{ entry.name }}
                                {% endif %}
                            </span>
                        </div>
                    </td>
                    <td class="bio-old">{{ entry.bio }}</td>
                    <td class="bio-new">{{ entry.new_bio }}</td> 
                    <td>{{ entry.subject }}</td>
                    <!--<td>
                        <span id="checkmark-{{ entry._id }}" class="checkmark {% if entry.activ %}green{% else %}red{% endif %}" 
                              onclick="toggleActiv('{{ entry._id }}')">
                            {% if entry.activ %}
                                &#10003;
                            {% else %}
                                &#10007;
                            {% endif %}
                        </span>
                    </td>-->
                    <td>
                        <a href="https://x.com/{{ entry.twitter_username }}" target="_blank">
                            <img src="https://cdn-icons-png.freepik.com/256/3670/3670211.png?semt=ais_hybrid" alt="Twitter" class="twitter-logo">
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No changes found in database.</p>
        {% endif %}
    </div>

    <!-- Tab 3: People News -->


    <div id="tab3" class="tab-content">
        <!-- Date filter only for Tab 3 -->
        <div id="filter-container-3" style="margin-bottom: 20px;">
            <label for="countryFilterTab3">Filter by Country:</label>
            <select id="countryFilterTab3" onchange="loadPeopleNews()">
                <option value="">All</option>
            </select>
        
            <label for="partyFilterTab3" style="margin-left: 20px;">Filter by Party:</label>
            <select id="partyFilterTab3" onchange="loadPeopleNews()">
                <option value="">All</option>
            </select>
        
            <label for="groupFilterTab3" style="margin-left: 20px;">Filter by Group:</label>
            <select id="groupFilterTab3" onchange="loadPeopleNews()">
                <option value="">All</option>
            </select>
        
            <label for="subjectFilterTab3" style="margin-left: 20px;">Filter by Subject:</label>
            <select id="subjectFilterTab3" onchange="loadPeopleNews()">
                <option value="">All</option>
            </select>
            <br>
            <label for="isNewsFilterTab3" style="margin-left: 20px;">Filter by News:</label>
            <select id="isNewsFilterTab3" onchange="loadPeopleNews()">
                <option value="all">All</option>
                <option value="true">News Only</option>
                <option value="false">No News</option>
            </select>

            
            <label for="filter-date" style="margin-left: 20px;">Show news published after:</label>
            <input type="date" id="filter-date">

            <button id="search-button" style="margin-left: 10px;" onclick="loadPeopleNews()">Search</button>
        </div>
            
        <table id="people-news-table">
            <thead>
                <tr>
                    <th>Photo</th>
                    <th>Name</th>
                    <th>News</th>
                    <th>Subject</th>
                </tr>
            </thead>
            <tbody id="people-news-container">
            </tbody>
        </table>

    </div>

    <!-- Tab 4: Logs -->
    <div id="tab4" class="tab-content">
        <!-- Checkboxes for filtering by log type -->
        <div id="log-filter-container" style="margin-bottom: 20px;">
            <label><input type="checkbox" class="log-filter" value="DEBUG"> DEBUG</label>
            <label><input type="checkbox" class="log-filter" value="INFO" checked> INFO</label>
            <label><input type="checkbox" class="log-filter" value="ERROR" checked> ERROR</label>
            <label><input type="checkbox" class="log-filter" value="CRITICAL" checked> CRITICAL</label>

            <!-- Add refresh button -->
            <button id="refresh-button" onclick="loadLogs()" style="margin-left: 20px; padding: 5px 10px;">Refresh</button>

            <!-- Add clear logs button -->
            <button id="clear-button" onclick="clearLogs()" style="margin-left: 20px; padding: 5px 10px; background-color: red; color: white;">Clear Logs</button>
        </div>

        <!-- Table to display logs -->
        <table id="logs-table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Message</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="logs-container">
                <!-- Log entries will be dynamically inserted here -->
            </tbody>
        </table>
    </div>

    <!-- Tab 5: Add User -->
    <div id="tab5" class="tab-content">
        <form id="addUserForm" onsubmit="return addUser()" class="styled-form">
            <div class="form-group">
                <label for="name">Name (Firstname LASTNAME):</label>
                <input type="text" id="name" name="name" required>
            </div>
    
            <div class="form-group">
                <label for="profileUrl">Profile URL:</label>
                <input type="url" id="profileUrl" name="profileUrl">
            </div>
    
            <div class="form-group">
                <label for="photoUrl">Photo URL:</label>
                <input type="url" id="photoUrl" name="photoUrl">
            </div>
    
            <div class="form-group">
                <label for="twitterUsername">Twitter Username:</label>
                <input type="text" id="twitterUsername" name="twitterUsername">
            </div>
    
            <div class="form-group">
                <label for="googleAlertFeed">All Google Alert Feed URL:</label>
                <input type="url" id="googleAlertFeed" name="googleAlertFeed">
            </div>

            <div class="form-group">
                <label for="NewsgoogleAlertFeed">News Only Google Alert Feed URL:</label>
                <input type="url" id="NewsgoogleAlertFeed" name="NewsgoogleAlertFeed">
            </div>
            
            <div class="form-group">
                <label for="subject">Subject:</label>
                <input type="text" id="subject" name="subject">
            </div>
    
            <button type="submit" class="styled-button">Add User to Database</button>
        </form>

        <!-- Table for Twitter Bios Collection -->
        <h3>Custom Twitter User</h3>
        <table id="twitterBiosTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Twitter</th>
                    <th>Subject</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody id="twitterBiosTableBody">
                <!-- Twitter bios entries will be dynamically injected here -->
            </tbody>
        </table>

        <!-- Table for RSS Feeds Collection -->
        <h3>Custom Google Alerts</h3>
        <table id="rssFeedsTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Subject</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody id="rssFeedsTableBody">
                <!-- RSS feed entries will be dynamically injected here -->
            </tbody>
        </table>
    </div>

    <p></p>
</body>
</html>
